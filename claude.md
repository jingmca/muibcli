# ICLI (Interactive Brokers CLI) é¡¹ç›®æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

**icli** æ˜¯ä¸€ä¸ªç”¨äº Interactive Brokersï¼ˆIBKRï¼‰å®æ—¶äº¤æ˜“çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸“é—¨è®¾è®¡ç”¨äºå¿«é€Ÿæ‰§è¡Œäº¤æ˜“ç­–ç•¥ï¼Œæ”¯æŒè‚¡ç¥¨ã€æœŸè´§ã€æœŸæƒå’Œå¤–æ±‡äº¤æ˜“ã€‚è¯¥å·¥å…·ç‰¹åˆ«é€‚åˆæ—¥å†…äº¤æ˜“ï¼ˆscalpingï¼‰å’Œæ³¢æ®µäº¤æ˜“ï¼ˆswing tradingï¼‰ï¼Œå¼ºè°ƒå¿«é€Ÿç†è§£ä»“ä½å’Œæ´»è·ƒè®¢å•ï¼ŒåŒæ—¶å‡å°‘ä¸‹å•æ—¶çš„å†—ä½™æ­¥éª¤ã€‚

## ğŸ“Œ ä¸»è¦åŠŸèƒ½

- **å®æ—¶äº¤æ˜“æ‰§è¡Œ** - æ— éœ€ç¡®è®¤çš„å¿«é€Ÿä¸‹å•ï¼ˆ"you type it, it happens"ï¼‰
- **å¤šèµ„äº§æ”¯æŒ** - è‚¡ç¥¨ã€æœŸè´§ã€æœŸæƒã€å¤–æ±‡
- **å®æ—¶å¸‚åœºæ•°æ®** - å¸¦é¢œè‰²æ¸å˜çš„è¡Œæƒ…æ˜¾ç¤ºï¼Œæ”¯æŒæœŸæƒå¸Œè…Šå€¼
- **è‡ªåŠ¨åŒ–äº¤æ˜“** - æ¡ä»¶è§¦å‘ç³»ç»Ÿï¼Œæ”¯æŒæŠ€æœ¯æŒ‡æ ‡
- **æ‰¹é‡æ“ä½œ** - å¹¶å‘æ‰§è¡Œå¤šä¸ªäº¤æ˜“å‘½ä»¤
- **æ™ºèƒ½è®¢å•è¯­æ³•** - æ”¯æŒå¤æ‚çš„è®¢å•è¡¨è¾¾å¼

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
muibcli/
â”œâ”€â”€ icli/                    # ä¸»ç¨‹åºåŒ…
â”‚   â”œâ”€â”€ __main__.py          # å…¥å£ç‚¹ï¼Œå¤„ç†ç¯å¢ƒå˜é‡å’Œå¯åŠ¨CLI
â”‚   â”œâ”€â”€ cli.py               # æ ¸å¿ƒCLIåº”ç”¨ç±»ï¼ˆIBKRCmdlineAppï¼Œ263KBï¼‰
â”‚   â”œâ”€â”€ cmds/                # å‘½ä»¤ç³»ç»Ÿï¼ˆæ’ä»¶æ¶æ„ï¼‰
â”‚   â”‚   â”œâ”€â”€ base.py          # IOpåŸºç±»å’Œ@commandè£…é¥°å™¨
â”‚   â”‚   â”œâ”€â”€ dispatch.py      # å‘½ä»¤è·¯ç”±åˆ†å‘å™¨
â”‚   â”‚   â”œâ”€â”€ orders/          # è®¢å•ç®¡ç†å‘½ä»¤ï¼ˆ8ä¸ªå‘½ä»¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ portfolio/       # æŠ•èµ„ç»„åˆå‘½ä»¤ï¼ˆ6ä¸ªå‘½ä»¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ quotes/          # å®æ—¶è¡Œæƒ…å‘½ä»¤ï¼ˆ10ä¸ªå‘½ä»¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ predicates/      # æ¡ä»¶è§¦å‘å‘½ä»¤ï¼ˆ7ä¸ªå‘½ä»¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ utilities/       # å®ç”¨å·¥å…·å‘½ä»¤ï¼ˆ19ä¸ªå‘½ä»¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ quote_mgmt/      # è¡Œæƒ…ç®¡ç†å‘½ä»¤ï¼ˆ12ä¸ªå‘½ä»¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ schedule/        # è®¡åˆ’ä»»åŠ¡å‘½ä»¤ï¼ˆ6ä¸ªå‘½ä»¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ tasks/           # åå°ä»»åŠ¡å‘½ä»¤ï¼ˆ2ä¸ªå‘½ä»¤ï¼‰
â”‚   â”‚   â””â”€â”€ connection/      # è¿æ¥ç®¡ç†å‘½ä»¤ï¼ˆ1ä¸ªå‘½ä»¤ï¼‰
â”‚   â”œâ”€â”€ helpers.py           # é€šç”¨è¾…åŠ©å‡½æ•°ï¼ˆ108KBï¼‰
â”‚   â”œâ”€â”€ orders.py            # è®¢å•ç±»å‹å®šä¹‰ï¼ˆ24KBï¼‰
â”‚   â”œâ”€â”€ futsexchanges.py     # æœŸè´§äº¤æ˜“æ‰€æ˜ å°„ï¼ˆ116KBï¼‰
â”‚   â”œâ”€â”€ instrumentdb.py      # é‡‘èå·¥å…·æ•°æ®åº“ï¼ˆ26KBï¼‰
â”‚   â”œâ”€â”€ calc.py              # è®¡ç®—å™¨åŠŸèƒ½ï¼ˆ9KBï¼‰
â”‚   â””â”€â”€ awwdio.py            # éŸ³é¢‘æ’­æŠ¥æ”¯æŒï¼ˆmacOSï¼‰
â”œâ”€â”€ .env.icli                # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ pyproject.toml           # Poetryé¡¹ç›®é…ç½®
â”œâ”€â”€ poetry.lock              # ä¾èµ–é”å®šæ–‡ä»¶
â””â”€â”€ README.md                # è¯¦ç»†æ–‡æ¡£ï¼ˆ33KBï¼‰
```

### å‘½ä»¤ç³»ç»Ÿæ¶æ„

- **71ä¸ªå‘½ä»¤** åˆ†å¸ƒåœ¨9ä¸ªç±»åˆ«ä¸­
- **è‡ªåŠ¨å‘ç°æœºåˆ¶** - å‘½ä»¤é€šè¿‡ `@command` è£…é¥°å™¨è‡ªåŠ¨æ³¨å†Œ
- **æ’ä»¶å¼æ¶æ„** - æ¯ä¸ªå‘½ä»¤ç‹¬ç«‹æ–‡ä»¶ï¼Œæ˜“äºæ‰©å±•
- **ç±»åˆ«è‡ªåŠ¨æ£€æµ‹** - ä»ç›®å½•ç»“æ„è‡ªåŠ¨æ¨æ–­å‘½ä»¤ç±»åˆ«

## ğŸ’¡ æ ¸å¿ƒç‰¹æ€§

### 1. å¿«é€Ÿäº¤æ˜“æ‰§è¡Œ
```bash
# åŸºç¡€ä¹°å…¥
buy AAPL 100 AF

# å¸¦é™ä»·çš„ä¹°å…¥
buy AAPL 100 AF @ 233.33

# å¸¦æ­¢ç›ˆæ­¢æŸçš„ä¹°å…¥
buy AAPL 100 AF @ 233.33 Â± 10

# æŒ‰é‡‘é¢ä¹°å…¥
buy MSFT $10_000 AF

# æ‰¹é‡ä¹°å…¥
expand buy {META,MSFT,NVDA,AMD,AAPL} $15_000 MID
```

### 2. å®æ—¶å¸‚åœºæ•°æ®
- è‚¡ç¥¨/æœŸè´§è¡Œæƒ…ï¼šæ˜¾ç¤ºå½“å‰ä»·ã€æ¶¨è·Œå¹…ã€æœ€é«˜æœ€ä½ã€ä¹°å–ç›˜
- æœŸæƒè¡Œæƒ…ï¼šæ˜¾ç¤ºæ ‡çš„ä»·æ ¼ã€IVã€å¸Œè…Šå€¼ã€ä¹°å–ä»·å·®
- å¸‚åœºæ·±åº¦ï¼šDOMï¼ˆDepth of Marketï¼‰æŸ¥çœ‹

### 3. è‡ªåŠ¨åŒ–äº¤æ˜“
```bash
# ä»·æ ¼è§¦å‘
if AAPL last > 300: buy AAPL 100 AF

# æŠ€æœ¯æŒ‡æ ‡è§¦å‘
# æ”¯æŒ EMAäº¤å‰ã€ATRã€æˆäº¤é‡ç­‰å¤šç§æŒ‡æ ‡
```

### 4. å†…ç½®è®¡ç®—å™¨
```bash
# è®¡ç®—å¯ä¹°è‚¡æ•°ï¼ˆ33%ä¿è¯é‡‘ï¼‰
(/ :BP3 AAPL)

# è®¡ç®—èµ„é‡‘å¢é•¿
(grow :AF 300)

# å¤æ‚è®¡ç®—
(grow (* AAPL (/ :BP3 AAPL)) 7)
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **Python 3.12+** - ä¸»è¦ç¼–ç¨‹è¯­è¨€
- **ib_async** - IBKR APIå¼‚æ­¥å°è£…ï¼ˆ>=2.0.1ï¼‰
- **pandas** - æ•°æ®å¤„ç†å’Œåˆ†æï¼ˆ>2.1.0ï¼‰
- **prompt-toolkit** - äº¤äº’å¼CLIç•Œé¢ï¼ˆ^3.0.29ï¼‰
- **asyncio** - å¼‚æ­¥ç¼–ç¨‹æ”¯æŒ
- **loguru** - é«˜çº§æ—¥å¿—ç³»ç»Ÿï¼ˆ>0.6.0ï¼‰
- **questionary** - å¤šæ­¥éª¤CLIæç¤ºï¼ˆ^2.0.1ï¼‰
- **seaborn** - ANSIæ§åˆ¶å°é¢œè‰²ï¼ˆ^0.12.2ï¼‰
- **tradeapis** - è‡ªå®šä¹‰äº¤æ˜“APIè¾…åŠ©åº“

## ğŸ“‹ ä½¿ç”¨æ–¹å¼

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/mattsta/icli
cd icli

# å®‰è£…ä¾èµ–
poetry install

# é…ç½®è´¦æˆ·ä¿¡æ¯
cp .env.icli.example .env.icli
# ç¼–è¾‘ .env.icli è®¾ç½® ICLI_IBKR_ACCOUNT_ID
```

### 2. å¯åŠ¨IBKR Gateway
- ä¸‹è½½å¹¶å®‰è£… [IBKR Gateway](https://www.interactivebrokers.com/en/index.php?f=16457)
- ç™»å½•Gatewayï¼ˆéœ€è¦2FAéªŒè¯ï¼‰
- ç¡®è®¤APIè®¾ç½®ï¼ˆé»˜è®¤ç«¯å£ï¼šå®ç›˜4001ï¼Œæ¨¡æ‹Ÿ4002ï¼‰

### 3. è¿è¡ŒCLI
```bash
# ä½¿ç”¨é»˜è®¤é…ç½®
poetry run icli

# æŒ‡å®šç«¯å£
ICLI_IBKR_PORT=4002 poetry run icli  # æ¨¡æ‹Ÿè´¦æˆ·
```

### 4. å¸¸ç”¨å‘½ä»¤
```bash
# æŸ¥çœ‹å¸®åŠ©
?                   # æ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤
positions?          # æŸ¥çœ‹positionså‘½ä»¤å¸®åŠ©

# è´¦æˆ·ç®¡ç†
positions           # æŸ¥çœ‹æŒä»“
balance             # æŸ¥çœ‹ä½™é¢
cash                # æŸ¥çœ‹ç°é‡‘
executions          # æŸ¥çœ‹æ‰§è¡Œè®°å½•

# è¡Œæƒ…ç®¡ç†
add SPY QQQ AAPL    # æ·»åŠ å®æ—¶è¡Œæƒ…
remove SPY          # ç§»é™¤è¡Œæƒ…
depth AAPL          # æŸ¥çœ‹å¸‚åœºæ·±åº¦

# äº¤æ˜“æ‰§è¡Œ
buy AAPL 100 MID    # ä¹°å…¥100è‚¡
sell AAPL 100 MID   # å–å‡º100è‚¡
evict AAPL -1 0 MID # æ¸…ç©ºAAPLæŒä»“
cancel *            # å–æ¶ˆæ‰€æœ‰è®¢å•
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ— ç¡®è®¤æœºåˆ¶** - æ‰€æœ‰å‘½ä»¤ç«‹å³æ‰§è¡Œ
2. **è´¦æˆ·è¦æ±‚** - éœ€è¦IBKRå®æ—¶æ•°æ®è®¢é˜…
3. **APIé™åˆ¶** - å—IBKR APIé™åˆ¶ï¼ˆè®¢å•æ•ˆç‡æ¯”ã€å¹¶å‘é™åˆ¶ç­‰ï¼‰
4. **PDTè§„åˆ™** - è´¦æˆ·ä½äº$25kå—æ—¥å†…äº¤æ˜“é™åˆ¶
5. **å¸‚åœºæ—¶é—´** - ç¾è‚¡äº¤æ˜“æ—¶é—´ 9:30-16:00 ET

## ğŸ”§ ä¿®æ”¹åŸåˆ™

### 1. æœ€å°æ”¹åŠ¨åŸåˆ™
- **ä¼˜å…ˆä¿®æ”¹é…ç½®** è€Œéä»£ç é€»è¾‘
- **ä¿æŒå‘åå…¼å®¹** - ä¸ç ´åç°æœ‰åŠŸèƒ½
- **å±€éƒ¨ä¿®æ”¹ä¼˜å…ˆ** - é¿å…å¤§è§„æ¨¡é‡æ„
- **ä¿ç•™åŸæœ‰æ³¨é‡Š** - æ·»åŠ æ–°æ³¨é‡Šè¯´æ˜ä¿®æ”¹åŸå› 
- **éµå¾ªç°æœ‰é£æ ¼** - ä¿æŒä»£ç é£æ ¼ä¸€è‡´æ€§

### 2. æµ‹è¯•è¦æ±‚
æ¯æ¬¡ä¿®æ”¹éƒ½å¿…é¡»ï¼š
- **æ„é€ æµ‹è¯•ç”¨ä¾‹** - è¦†ç›–æ­£å¸¸å’Œå¼‚å¸¸æƒ…å†µ
- **å•å…ƒæµ‹è¯•** - æµ‹è¯•ä¿®æ”¹çš„å…·ä½“åŠŸèƒ½
- **é›†æˆæµ‹è¯•** - éªŒè¯ä¸å…¶ä»–æ¨¡å—çš„äº¤äº’
- **è¾¹ç•Œæµ‹è¯•** - æµ‹è¯•æé™å€¼å’Œå¼‚å¸¸è¾“å…¥
- **å›å½’æµ‹è¯•** - ç¡®ä¿æœªç ´åç°æœ‰åŠŸèƒ½

ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹ï¼š
```python
# æµ‹è¯•æ–°å¢çš„è®¢å•åŠŸèƒ½
async def test_new_order_feature():
    # 1. æ­£å¸¸æƒ…å†µ
    result = await buy_order("AAPL", 100, "MID")
    assert result.status == "Submitted"

    # 2. å¼‚å¸¸è¾“å…¥
    result = await buy_order("INVALID", -100, "MID")
    assert result is None

    # 3. è¾¹ç•Œæ¡ä»¶
    result = await buy_order("AAPL", 0.001, "MID")
    assert result.quantity == 0.001
```

### 3. å®é™…ç¯å¢ƒéªŒè¯
åœ¨tmuxä¸­è¿›è¡Œå®é™…éªŒè¯ï¼š
```bash
# 1. æ–°å»ºtmuxçª—æ ¼
Ctrl+b %  # å‚ç›´åˆ†å‰²
Ctrl+b "  # æ°´å¹³åˆ†å‰²

# 2. åœ¨æ–°çª—æ ¼ä¸­å¯åŠ¨icli
poetry run icli

# 3. æ‰§è¡ŒéªŒè¯å‘½ä»¤åºåˆ—
positions       # æŸ¥çœ‹å½“å‰æŒä»“
cash           # æŸ¥çœ‹ç°é‡‘ä½™é¢
add SPY        # æ·»åŠ è¡Œæƒ…æµ‹è¯•
buy SPY 1 MID preview  # é¢„è§ˆè®¢å•ï¼ˆä¸æ‰§è¡Œï¼‰
orders         # æŸ¥çœ‹æ´»è·ƒè®¢å•
```

### 4. å¸¸ç”¨éªŒè¯å‘½ä»¤

#### åŸºç¡€éªŒè¯
```bash
# è´¦æˆ·çŠ¶æ€éªŒè¯
positions      # éªŒè¯æŒä»“æ˜¾ç¤ºæ­£ç¡®
cash          # éªŒè¯ç°é‡‘è®¡ç®—å‡†ç¡®
balance       # éªŒè¯æ€»èµ„äº§æ­£ç¡®
balance SMA   # éªŒè¯ä¿è¯é‡‘ä¿¡æ¯

# è¡Œæƒ…éªŒè¯
add SPY QQQ   # éªŒè¯è¡Œæƒ…æ·»åŠ åŠŸèƒ½
remove SPY    # éªŒè¯è¡Œæƒ…ç§»é™¤åŠŸèƒ½
qquote AAPL   # éªŒè¯å¿«é€ŸæŠ¥ä»·åŠŸèƒ½
```

#### äº¤æ˜“éªŒè¯
```bash
# è®¢å•é¢„è§ˆï¼ˆä¸å®é™…æ‰§è¡Œï¼‰
buy AAPL 1 MID preview     # é¢„è§ˆä¹°å•
sell AAPL 1 MID preview    # é¢„è§ˆå–å•

# è®¢å•ç®¡ç†
orders                     # æŸ¥çœ‹æ‰€æœ‰æ´»è·ƒè®¢å•
cancel                     # å–æ¶ˆè®¢å•ï¼ˆå¸¦é€‰æ‹©èœå•ï¼‰
modify                     # ä¿®æ”¹è®¢å•

# æ‰§è¡Œè®°å½•
executions                 # æŸ¥çœ‹ä»Šæ—¥æ‰§è¡Œ
executions -v              # è¯¦ç»†æ‰§è¡Œä¿¡æ¯
```

#### é«˜çº§åŠŸèƒ½éªŒè¯
```bash
# è®¡ç®—å™¨åŠŸèƒ½
(/ :BP3 AAPL)             # è®¡ç®—å¯ä¹°è‚¡æ•°
(* AAPL 100)              # è®¡ç®—æ€»ä»·å€¼

# æ¡ä»¶è§¦å‘
iflist                    # æŸ¥çœ‹æ‰€æœ‰æ¡ä»¶è§¦å‘å™¨
ifclear                   # æ¸…é™¤æ¡ä»¶è§¦å‘å™¨

# æ‰¹é‡æ“ä½œ
expand buy {AAPL,MSFT} 1 MID preview
```

### 5. æäº¤å‰æ£€æŸ¥æ¸…å•

- [ ] ä»£ç ç¬¦åˆPythonç¼–ç è§„èŒƒï¼ˆPEP 8ï¼‰
- [ ] æ·»åŠ äº†é€‚å½“çš„ç±»å‹æ³¨è§£
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£å’Œæ³¨é‡Š
- [ ] é€šè¿‡äº†æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹
- [ ] åœ¨å®é™…ç¯å¢ƒä¸­éªŒè¯åŠŸèƒ½
- [ ] æ£€æŸ¥äº†æ—¥å¿—è¾“å‡ºï¼ˆicli-*.logï¼‰
- [ ] ç¡®è®¤æ²¡æœ‰å¼•å…¥æ–°çš„ä¾èµ–å†²çª
- [ ] éªŒè¯äº†ä¸ç°æœ‰åŠŸèƒ½çš„å…¼å®¹æ€§

### 6. è°ƒè¯•æŠ€å·§

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export LOGURU_LEVEL=DEBUG
poetry run icli

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f icli-*.log

# æ£€æŸ¥ç‰¹å®šå‘½ä»¤çš„æ‰§è¡Œ
grep "buy" icli-*.log

# ç›‘æ§è®¢å•çŠ¶æ€å˜åŒ–
grep "orderStatus" icli-*.log
```

## ğŸ§ª æ ‡å‡†æµ‹è¯•æµç¨‹

### å®Œæ•´æµ‹è¯•å·¥ä½œæµç¨‹

æ¯æ¬¡ä»£ç ä¿®æ”¹å¿…é¡»æŒ‰ä»¥ä¸‹é¡ºåºå®Œæˆæ‰€æœ‰æµ‹è¯•æ­¥éª¤ï¼š

#### é˜¶æ®µ1ï¼šä»£ç å®¡æŸ¥ï¼ˆä¿®æ”¹å‰ï¼‰
```bash
# 1. ç†è§£å¾…ä¿®æ”¹ä»£ç çš„ä¸Šä¸‹æ–‡
# 2. è¯†åˆ«æ‰€æœ‰ä¾èµ–å…³ç³»å’Œè°ƒç”¨ç‚¹
# 3. ç¡®å®šå¯èƒ½çš„å‰¯ä½œç”¨èŒƒå›´
# 4. è§„åˆ’æµ‹è¯•ç­–ç•¥
```

#### é˜¶æ®µ2ï¼šå•å…ƒæµ‹è¯•ï¼ˆä¿®æ”¹åï¼‰
åˆ›å»ºç‹¬ç«‹çš„æµ‹è¯•è„šæœ¬éªŒè¯æ ¸å¿ƒåŠŸèƒ½ï¼š

```python
#!/usr/bin/env python3
"""
Test script for [feature name]
"""

def test_feature_basic():
    """Test basic functionality"""
    # 1. æµ‹è¯•æ­£å¸¸è¾“å…¥
    result = function_under_test(valid_input)
    assert result == expected_output
    print("âœ… Basic test passed")

def test_feature_edge_cases():
    """Test edge cases"""
    # 2. æµ‹è¯•è¾¹ç•Œæ¡ä»¶
    result = function_under_test(edge_case_input)
    assert result == expected_edge_output
    print("âœ… Edge case test passed")

def test_feature_error_handling():
    """Test error handling"""
    # 3. æµ‹è¯•å¼‚å¸¸æƒ…å†µ
    try:
        function_under_test(invalid_input)
        assert False, "Should have raised exception"
    except ExpectedException:
        print("âœ… Error handling test passed")

if __name__ == "__main__":
    test_feature_basic()
    test_feature_edge_cases()
    test_feature_error_handling()
    print("\nğŸ‰ All unit tests passed!")
```

**è¿è¡Œå•å…ƒæµ‹è¯•**ï¼š
```bash
# ç¡®ä¿Pythonè·¯å¾„æ­£ç¡®
export PYTHONPATH=/Users/jingming/Downloads/muibcli:$PYTHONPATH

# è¿è¡Œæµ‹è¯•è„šæœ¬
python3 test_your_feature.py
```

#### é˜¶æ®µ3ï¼šæ¸…ç†Pythonç¼“å­˜
åœ¨å®é™…ç¯å¢ƒæµ‹è¯•å‰ï¼Œå¿…é¡»æ¸…ç†æ‰€æœ‰ `__pycache__`ï¼š

```bash
# æ¸…ç†æ‰€æœ‰Pythonç¼“å­˜
find icli -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null

# æˆ–ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹æ³•
find icli -type d -name __pycache__ | xargs rm -rf
```

**ä¸ºä»€ä¹ˆé‡è¦**ï¼šPythonä¼šç¼“å­˜å·²ç¼–è¯‘çš„ `.pyc` æ–‡ä»¶ï¼Œä¸æ¸…ç†å¯èƒ½å¯¼è‡´æµ‹è¯•æ—§ç‰ˆæœ¬ä»£ç ã€‚

#### é˜¶æ®µ4ï¼šCLIç¯å¢ƒé›†æˆæµ‹è¯•
åœ¨tmuxä¸­è¿›è¡Œå®é™…CLIæµ‹è¯•ï¼š

```bash
# 1. åˆ›å»ºæ–°çš„tmuxä¼šè¯ï¼ˆæˆ–ä½¿ç”¨ç°æœ‰ä¼šè¯ï¼‰
tmux new -s icli-test

# 2. åˆ†å‰²çª—æ ¼ç”¨äºå¤šä»»åŠ¡ç›‘æ§
Ctrl+b %  # å‚ç›´åˆ†å‰²ï¼ˆç”¨äºæŸ¥çœ‹æ—¥å¿—ï¼‰
Ctrl+b "  # æ°´å¹³åˆ†å‰²ï¼ˆç”¨äºå¤šå‘½ä»¤æµ‹è¯•ï¼‰

# 3. åœ¨ä¸»çª—æ ¼å¯åŠ¨icli
poetry run icli

# 4. åœ¨å¦ä¸€ä¸ªçª—æ ¼æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f icli-*.log
```

**æ ‡å‡†æµ‹è¯•åœºæ™¯**ï¼š

```bash
# A. å‘½ä»¤åŸºç¡€åŠŸèƒ½æµ‹è¯•
<command>           # æ— å‚æ•°è°ƒç”¨
<command>?          # æŸ¥çœ‹å¸®åŠ©
man <command>       # æŸ¥çœ‹è¯¦ç»†æ‰‹å†Œ

# B. å‚æ•°æµ‹è¯•
<command> arg1                    # å•å‚æ•°
<command> arg1 arg2               # å¤šå‚æ•°
<command> arg1 arg2 ... argN      # å¯å˜å‚æ•°
<command> --flag                  # æ ‡å¿—å‚æ•°

# C. è¾¹ç•Œæ¡ä»¶æµ‹è¯•
<command> ""                      # ç©ºå­—ç¬¦ä¸²
<command> 0                       # é›¶å€¼
<command> -1                      # è´Ÿå€¼
<command> 999999999               # æå¤§å€¼
<command> invalid_symbol          # æ— æ•ˆè¾“å…¥

# D. é”™è¯¯å¤„ç†æµ‹è¯•
<command> invalid_args            # é”™è¯¯å‚æ•°
<command> missing_required_arg    # ç¼ºå°‘å¿…éœ€å‚æ•°
```

#### é˜¶æ®µ5ï¼šåŠŸèƒ½éªŒè¯æ£€æŸ¥æ¸…å•

é’ˆå¯¹ä¸åŒç±»å‹çš„ä¿®æ”¹ï¼Œä½¿ç”¨å¯¹åº”çš„éªŒè¯æ¸…å•ï¼š

**æ–°å¢å‘½ä»¤éªŒè¯**ï¼š
- [ ] å‘½ä»¤èƒ½å¤Ÿè¢«æ­£ç¡®è¯†åˆ«å’Œè°ƒç”¨
- [ ] å¸®åŠ©ä¿¡æ¯æ˜¾ç¤ºæ­£ç¡®ï¼ˆ`command?` å’Œ `man command`ï¼‰
- [ ] å‚æ•°è§£æå·¥ä½œæ­£å¸¸ï¼ˆåŒ…æ‹¬å¯é€‰å’Œå¿…éœ€å‚æ•°ï¼‰
- [ ] è¾“å‡ºæ ¼å¼ç¬¦åˆé¡¹ç›®é£æ ¼ï¼ˆå¯¹é½ã€é¢œè‰²ã€ç¬¦å·ï¼‰
- [ ] é”™è¯¯æ¶ˆæ¯æ¸…æ™°ä¸”æœ‰å¸®åŠ©
- [ ] å‘½ä»¤åœ¨COMMANDS_HELP.mdä¸­æœ‰æ–‡æ¡£

**è®¢å•ç›¸å…³ä¿®æ”¹éªŒè¯**ï¼š
- [ ] ä½¿ç”¨ `preview` æ¨¡å¼æµ‹è¯•ï¼ˆä¸å®é™…ä¸‹å•ï¼‰
- [ ] éªŒè¯è®¢å•å‚æ•°æ­£ç¡®ä¼ é€’åˆ°IBKR API
- [ ] æ£€æŸ¥è®¢å•çŠ¶æ€æ›´æ–°ï¼ˆ`orders` å‘½ä»¤ï¼‰
- [ ] éªŒè¯æ‰§è¡Œè®°å½•ï¼ˆ`executions` å‘½ä»¤ï¼‰
- [ ] æµ‹è¯•å–æ¶ˆå’Œä¿®æ”¹åŠŸèƒ½
- [ ] éªŒè¯ä¸åŒè®¢å•ç±»å‹ï¼ˆLMT, MKT, AF, MIDç­‰ï¼‰
- [ ] æµ‹è¯•GTC/DAYå’ŒRTHå‚æ•°

**è¡Œæƒ…ç›¸å…³ä¿®æ”¹éªŒè¯**ï¼š
- [ ] æ·»åŠ /ç§»é™¤è¡Œæƒ…åŠŸèƒ½æ­£å¸¸
- [ ] è¡Œæƒ…æ•°æ®å®æ—¶æ›´æ–°
- [ ] é¢œè‰²æ¸å˜æ˜¾ç¤ºæ­£ç¡®
- [ ] æœŸæƒå¸Œè…Šå€¼è®¡ç®—å‡†ç¡®
- [ ] å¸‚åœºæ·±åº¦æ•°æ®å®Œæ•´

**é”™è¯¯å¤„ç†ä¿®æ”¹éªŒè¯**ï¼š
- [ ] éªŒè¯é”™è¯¯æŠ‘åˆ¶æœºåˆ¶ï¼ˆå¦‚15åˆ†é’Ÿ/5æ¬¡é˜ˆå€¼ï¼‰
- [ ] æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä¸­é”™è¯¯è®°å½•å®Œæ•´
- [ ] ç¡®è®¤ç»ˆç«¯æ˜¾ç¤ºç¬¦åˆé¢„æœŸ
- [ ] æµ‹è¯•ä¸åŒé”™è¯¯ä»£ç çš„å¤„ç†
- [ ] éªŒè¯é”™è¯¯è®¡æ•°å’Œæ—¶é—´çª—å£

#### é˜¶æ®µ6ï¼šæ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
cat icli-*.log

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—
tail -100 icli-*.log

# æœç´¢é”™è¯¯ä¿¡æ¯
grep "ERROR" icli-*.log
grep "WARNING" icli-*.log

# æœç´¢ç‰¹å®šåŠŸèƒ½çš„æ—¥å¿—
grep "your_function_name" icli-*.log
grep "Order" icli-*.log
grep "orderStatus" icli-*.log

# æŸ¥çœ‹é”™è¯¯ä»£ç ç»Ÿè®¡
grep "code [0-9]*" icli-*.log | sort | uniq -c
```

#### é˜¶æ®µ7ï¼šå›å½’æµ‹è¯•

ç¡®ä¿ä¿®æ”¹æ²¡æœ‰ç ´åç°æœ‰åŠŸèƒ½ï¼š

```bash
# æ ¸å¿ƒåŠŸèƒ½å›å½’æµ‹è¯•
positions          # æŒä»“æ˜¾ç¤º
cash              # ç°é‡‘ä½™é¢
balance           # è´¦æˆ·æ€»è§ˆ
add SPY QQQ       # è¡Œæƒ…ç®¡ç†
orders            # è®¢å•æŸ¥è¯¢
executions        # æ‰§è¡Œè®°å½•

# äº¤æ˜“åŠŸèƒ½å›å½’æµ‹è¯•ï¼ˆä½¿ç”¨previewï¼‰
buy AAPL 1 LMT @ 100 preview
sell SPY 1 MKT preview
evict AAPL 0 0 MID preview

# é«˜çº§åŠŸèƒ½å›å½’æµ‹è¯•
(/ :BP3 AAPL)     # è®¡ç®—å™¨
iflist            # æ¡ä»¶è§¦å‘
hh                # å¿«é€Ÿå¸®åŠ©
man positions     # è¯¦ç»†æ‰‹å†Œ
```

### æµ‹è¯•å¤±è´¥å¤„ç†æµç¨‹

å¦‚æœæµ‹è¯•å¤±è´¥ï¼š

1. **ç«‹å³åœæ­¢** - ä¸è¦ç»§ç»­å…¶ä»–æµ‹è¯•
2. **è®°å½•ç°è±¡** - æˆªå±ã€ä¿å­˜æ—¥å¿—ã€è®°å½•é”™è¯¯æ¶ˆæ¯
3. **åˆ†æåŸå› ** - ä½¿ç”¨è°ƒè¯•æ—¥å¿—è¿½è¸ªé—®é¢˜
4. **ä¿®å¤ä»£ç ** - é’ˆå¯¹æ€§ä¿®æ”¹
5. **æ¸…ç†ç¼“å­˜** - åˆ é™¤ `__pycache__` é‡æ–°æµ‹è¯•
6. **é‡æ–°æµ‹è¯•** - ä»é˜¶æ®µ2å¼€å§‹å®Œæ•´é‡æµ‹
7. **éªŒè¯ä¿®å¤** - ç¡®è®¤é—®é¢˜å®Œå…¨è§£å†³

### å¸¸è§æµ‹è¯•é™·é˜±

**é™·é˜±1ï¼šPythonç¼“å­˜å¯¼è‡´æµ‹è¯•æ—§ä»£ç **
```bash
# ç—‡çŠ¶ï¼šä¿®æ”¹ä»£ç åè¡Œä¸ºæ²¡å˜åŒ–
# è§£å†³ï¼šåˆ é™¤æ‰€æœ‰__pycache__
find icli -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null
```

**é™·é˜±2ï¼šå¼‚æ­¥å‡½æ•°æœªæ­£ç¡®æµ‹è¯•**
```python
# é”™è¯¯ï¼šåŒæ­¥è°ƒç”¨å¼‚æ­¥å‡½æ•°
result = async_function()  # âŒ

# æ­£ç¡®ï¼šä½¿ç”¨asyncioè¿è¡Œ
import asyncio
result = asyncio.run(async_function())  # âœ…
```

**é™·é˜±3ï¼šå‡è®¾å‚æ•°ç±»å‹è€Œä¸éªŒè¯**
```python
# é”™è¯¯ï¼šå‡è®¾å‚æ•°ç±»å‹
def process(cmd):
    return cmd.lower()  # å¦‚æœcmdæ˜¯listä¼šæŠ¥é”™

# æ­£ç¡®ï¼šéªŒè¯å’Œè½¬æ¢ç±»å‹
def process(cmd):
    if isinstance(cmd, list):
        cmd = cmd[0] if cmd else ""
    return cmd.lower()
```

**é™·é˜±4ï¼šæµ‹è¯•æ—¶å¿˜è®°æ£€æŸ¥æ—¥å¿—æ–‡ä»¶**
```bash
# é—®é¢˜ï¼šç»ˆç«¯çœ‹èµ·æ¥æ­£å¸¸ï¼Œä½†æ—¥å¿—ä¸­æœ‰ERROR
# è§£å†³ï¼šå§‹ç»ˆæ£€æŸ¥æ—¥å¿—æ–‡ä»¶
tail -50 icli-*.log | grep ERROR
```

### æµ‹è¯•æ–‡æ¡£åŒ–

æ¯æ¬¡é‡è¦ä¿®æ”¹éƒ½åº”åˆ›å»ºæµ‹è¯•æ–‡æ¡£ï¼š

```markdown
# Test Report - [Feature Name]

## æµ‹è¯•æ—¥æœŸ
2025-XX-XX

## ä¿®æ”¹å†…å®¹
[ç®€è¦æè¿°ä¿®æ”¹å†…å®¹]

## å•å…ƒæµ‹è¯•
- [ ] test_basic_functionality - PASSED
- [ ] test_edge_cases - PASSED
- [ ] test_error_handling - PASSED

## CLIé›†æˆæµ‹è¯•
- [ ] Command recognition - PASSED
- [ ] Parameter parsing - PASSED
- [ ] Output formatting - PASSED
- [ ] Error messages - PASSED

## å›å½’æµ‹è¯•
- [ ] Existing commands still work - PASSED
- [ ] No new errors in logs - PASSED

## å‘ç°çš„é—®é¢˜
1. [é—®é¢˜æè¿°]
   - åŸå› ï¼š[æ ¹æœ¬åŸå› ]
   - ä¿®å¤ï¼š[ä¿®å¤æ–¹æ¡ˆ]
   - éªŒè¯ï¼š[å¦‚ä½•éªŒè¯ä¿®å¤]

## æµ‹è¯•é€šè¿‡æ ‡å‡†
âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
âœ… CLIç¯å¢ƒåŠŸèƒ½æ­£å¸¸
âœ… æ— å›å½’é—®é¢˜
âœ… æ—¥å¿—æ— å¼‚å¸¸é”™è¯¯
```

## ğŸ“š å‚è€ƒèµ„æº

- [IBKR APIæ–‡æ¡£](https://interactivebrokers.github.io/tws-api/)
- [ib_asyncæ–‡æ¡£](https://github.com/erdewit/ib_insync)
- [é¡¹ç›®GitHub](https://github.com/mattsta/icli)
- [IBKR Gatewayä¸‹è½½](https://www.interactivebrokers.com/en/index.php?f=16457)

## ğŸ”„ æ›´æ–°å†å²

- 2025å¹´ - å‘½ä»¤ç³»ç»Ÿé‡æ„ä¸ºæ’ä»¶æ¶æ„
- æ”¯æŒPython 3.12+
- 71ä¸ªå‘½ä»¤åˆ†å¸ƒåœ¨9ä¸ªç±»åˆ«ä¸­
- æ¨¡å—åŒ–è®¾è®¡æå‡å¯ç»´æŠ¤æ€§