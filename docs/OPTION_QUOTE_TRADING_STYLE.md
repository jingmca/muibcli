# æœŸæƒæŠ¥ä»·åŒº Trading é£æ ¼åˆ†æ

## ğŸ“Š å½“å‰çŠ¶æ€

### âš ï¸ é‡è¦è¯´æ˜

**QUOTE_PRESETS ç›®å‰åªæ˜¯æ¡†æ¶**ï¼ŒæŠ¥ä»·æ˜¾ç¤ºè¿˜**æœªå®ç°**æ ¹æ®é¢„è®¾è°ƒæ•´å­—æ®µï¼

å½“å‰æ‰€æœ‰æŠ¥ä»·ï¼ˆåŒ…æ‹¬æœŸæƒï¼‰éƒ½æ˜¯ä½¿ç”¨ `cli.py` ä¸­ `formatTicker()` å‡½æ•°çš„**å›ºå®šæ ¼å¼**ï¼Œä¸ä¼šå› ä¸ºè®¾ç½® `--quote-preset trading` è€Œæ”¹å˜æ˜¾ç¤ºå†…å®¹ã€‚

è¦çœŸæ­£å®ç°æ ¹æ®é¢„è®¾æ˜¾ç¤ºä¸åŒå­—æ®µï¼Œéœ€è¦**é‡æ„ `formatTicker()` å‡½æ•°**ã€‚

---

## ğŸ“‹ å½“å‰æœŸæƒæŠ¥ä»·æ˜¾ç¤ºçš„æ‰€æœ‰å­—æ®µ

**ä»£ç ä½ç½®**ï¼š`cli.py` line 4625-4644

### å®Œæ•´å­—æ®µåˆ—è¡¨

```python
return " ".join([
    rowName,                                              # 1. æœŸæƒç¬¦å·
    f"[u {und:>8,.2f} ({itm} {strikeDiff:>7,.2f}%)]",   # 2. æ ‡çš„ä»·æ ¼ + ITM + åç¦»åº¦
    f"[iv {iv:.2f}]",                                    # 3. éšå«æ³¢åŠ¨ç‡
    f"[d {delta:>5.2f}]",                                # 4. Delta
    f"{ema100:>6}",                                      # 5. 15åˆ†é’ŸEMA
    f"{trend}",                                           # 6. è¶‹åŠ¿æ ‡å¿— (>, <, =)
    f"{ema300:>6}",                                      # 7. 65åˆ†é’ŸEMA
    f"{mark:>6} Â±{spread:<4}",                           # 8. æ ‡è®°ä»· Â± ä»·å·®
    f"{bid:>6} x {bidSize}   {ask:>6} x {askSize}",     # 9. ä¹°å–ç›˜ + ç›˜å£é‡
    f"{vwapDiff}",                                       # 10. VWAPåç¦»
    f"({ago:>7})",                                       # 11. æ•°æ®æ›´æ–°æ—¶é—´
    f"(s {compensated:>8,.2f} @ {compdiff:>6,.2f})",    # 12. è¡Œæƒæˆæœ¬åˆ†æ
    f"({dte:>3.2f} d)",                                  # 13. åˆ°æœŸå¤©æ•°
    "HALTED!" if halted else "",                         # 14. åœç‰Œæ ‡å¿—
])
```

### å­—æ®µè¯¦è§£

| # | å­—æ®µ | ç¤ºä¾‹ | å®½åº¦ | è¯´æ˜ |
|---|------|------|------|------|
| 1 | **rowName** | `AAPL 0816 C220` | ~15 | æœŸæƒç¬¦å·ï¼ˆæ–°æ ¼å¼åŒ–åï¼‰ |
| 2 | **Underlying** | `[u 225.50 (I +2.50%)]` | ~25 | æ ‡çš„ä»·ã€ITMæ ‡å¿—ã€åç¦»åº¦ |
| 3 | **IV** | `[iv 0.25]` | ~10 | éšå«æ³¢åŠ¨ç‡ |
| 4 | **Delta** | `[d +0.65]` | ~10 | Deltaå¸Œè…Šå€¼ |
| 5 | **EMA100** | `5.25` | ~6 | 15åˆ†é’ŸEMA |
| 6 | **Trend** | `>` | ~1 | è¶‹åŠ¿æ ‡å¿— |
| 7 | **EMA300** | `5.10` | ~6 | 65åˆ†é’ŸEMA |
| 8 | **Mark** | `5.80 Â±0.15` | ~12 | æ ‡è®°ä»·å’Œä»·å·® |
| 9 | **Bid/Ask** | `5.75 x 10   5.85 x 15` | ~28 | ä¹°å–ç›˜å’Œç›˜å£é‡ |
| 10 | **VWAP** | `+0.10` | ~6 | VWAPåç¦» |
| 11 | **Ago** | `(2s ago)` | ~10 | æ•°æ®æ—¶é—´ |
| 12 | **Compensated** | `(s 214.20 @ +11.30)` | ~25 | è¡Œæƒæˆæœ¬ |
| 13 | **DTE** | `(30.5 d)` | ~10 | åˆ°æœŸå¤©æ•° |
| 14 | **Halted** | `HALTED!` | ~8 | åœç‰Œæ ‡å¿— |

**æ€»å®½åº¦**ï¼šçº¦ **180-200 å­—ç¬¦**

---

## ğŸ¯ å»ºè®®çš„ Trading é£æ ¼æœŸæƒæ˜¾ç¤º

### è®¾è®¡åŸåˆ™

**Trading é£æ ¼**åº”è¯¥ï¼š
- âœ… çªå‡º**ç›˜å£ä¿¡æ¯**ï¼ˆbid/ask/sizeï¼‰
- âœ… æ˜¾ç¤º**å…³é”®å¸Œè…Šå€¼**ï¼ˆdeltaï¼‰
- âœ… æ˜¾ç¤º**è¶‹åŠ¿æŒ‡æ ‡**ï¼ˆema, trendï¼‰
- âœ… æ˜¾ç¤º**ä»·æ ¼**ï¼ˆmark, spreadï¼‰
- âŒ éšè—**æ¬¡è¦ä¿¡æ¯**ï¼ˆcompensated, vwapï¼‰
- âŒ ç®€åŒ–**æ—¶é—´ä¿¡æ¯**ï¼ˆåˆå¹¶åˆ°ä¸€èµ·ï¼‰

### æ¨èå­—æ®µï¼ˆTrading é£æ ¼ï¼‰

```python
OPTION_TRADING_FIELDS = [
    "sym",              # æœŸæƒç¬¦å·
    "underlying",       # æ ‡çš„ä»·æ ¼
    "itm",             # ITMæ ‡å¿—
    "delta",           # Delta
    "ema100",          # å¿«é€ŸEMA
    "trend",           # è¶‹åŠ¿
    "mark",            # æ ‡è®°ä»·
    "spread",          # ä»·å·®
    "bid",             # ä¹°ä»·
    "bidSize",         # ä¹°é‡
    "ask",             # å–ä»·
    "askSize",         # å–é‡
    "dte",             # åˆ°æœŸå¤©æ•°
]
```

### æ˜¾ç¤ºç¤ºä¾‹ï¼ˆTrading é£æ ¼ï¼‰

**å®Œæ•´ç‰ˆ**ï¼ˆçº¦130å­—ç¬¦ï¼‰ï¼š
```
AAPL 0816 C220: [u 225.50 I] [d +0.65] 5.25> 5.80Â±0.15  5.75x10  5.85x15 (30d)
```

**ç´§å‡‘ç‰ˆ**ï¼ˆçº¦100å­—ç¬¦ï¼‰ï¼š
```
AAPL 0816 C220: [u225.5 I] [d+.65] 5.25> 5.80Â±.15 5.75x10 5.85x15 30d
```

**æç®€ç‰ˆ**ï¼ˆçº¦80å­—ç¬¦ï¼‰ï¼š
```
AAPL24C220: u225.5 d.65 5.80Â±.15 5.75x10 5.85x15
```

---

## ğŸ“Š ä¸åŒé£æ ¼å¯¹æ¯”

### Minimalï¼ˆæœ€å°åŒ–ï¼‰

**ç›®æ ‡**ï¼šåªçœ‹å…³é”®ä»·æ ¼ï¼Œé€‚åˆè¶…çª„ç»ˆç«¯

```
AAPL24C220: 5.80  5.75x5.85  +10.5%
```

**å­—æ®µ**ï¼š
- sym (ç´§å‡‘ç¬¦å·)
- mark (æ ‡è®°ä»·)
- bid/ask (ä¹°å–ä»·)
- change% (æ¶¨è·Œå¹…)

**å®½åº¦**ï¼š~40å­—ç¬¦

---

### Compactï¼ˆç´§å‡‘ï¼‰

**ç›®æ ‡**ï¼šæ—¥å¸¸æŸ¥çœ‹ï¼Œå¹³è¡¡ä¿¡æ¯é‡å’Œå®½åº¦

```
AAPL 0816 C220: [u225.5] [d+.65] 5.80Â±.15  5.75x10  5.85x15
```

**å­—æ®µ**ï¼š
- sym (æ ‡å‡†ç¬¦å·)
- underlying (æ ‡çš„ä»·)
- delta (Delta)
- mark Â± spread (ä»·æ ¼å’Œä»·å·®)
- bid/ask + size (ç›˜å£)

**å®½åº¦**ï¼š~65å­—ç¬¦

---

### Tradingï¼ˆäº¤æ˜“é‡ç‚¹ï¼‰â­

**ç›®æ ‡**ï¼šæ—¥å†…äº¤æ˜“ï¼Œçªå‡ºç›˜å£å’Œè¶‹åŠ¿

```
AAPL 0816 C220: [u225.5 I] [d+.65] 5.25>5.10 5.80Â±.15  5.75x10  5.85x15  30d
```

**å­—æ®µ**ï¼š
- sym (æ ‡å‡†ç¬¦å·)
- underlying + ITM (æ ‡çš„ä»·å’Œå®å€¼æ ‡å¿—)
- delta (Delta)
- ema100 > ema300 (è¶‹åŠ¿)
- mark Â± spread (ä»·æ ¼)
- bid/ask + size (ç›˜å£)
- dte (åˆ°æœŸå¤©æ•°)

**å®½åº¦**ï¼š~80å­—ç¬¦

---

### Optionsï¼ˆæœŸæƒä¸“ç”¨ï¼‰

**ç›®æ ‡**ï¼šæœŸæƒåˆ†æï¼Œå®Œæ•´å¸Œè…Šå€¼

```
AAPL 0816 C220: [u225.5 I +2.5%] [iv.25 d+.65 g.03 t-.15] 5.80Â±.15  5.75x10  5.85x15  30d
```

**å­—æ®µ**ï¼š
- sym (æ ‡å‡†ç¬¦å·)
- underlying + ITM + %diff (æ ‡çš„è¯¦æƒ…)
- **å®Œæ•´å¸Œè…Šå€¼** (IV, delta, gamma, theta)
- mark Â± spread (ä»·æ ¼)
- bid/ask + size (ç›˜å£)
- dte (åˆ°æœŸå¤©æ•°)

**å®½åº¦**ï¼š~95å­—ç¬¦

---

### Analysisï¼ˆæŠ€æœ¯åˆ†æï¼‰

**ç›®æ ‡**ï¼šæŠ€æœ¯åˆ†æï¼ŒEMA + VWAP

```
AAPL 0816 C220: [u225.5] e100:5.25(+.55)>e300:5.10  5.80Â±.15  vwap+.10  5.75x5.85  30d
```

**å­—æ®µ**ï¼š
- sym
- underlying
- ema100 (diff) è¶‹åŠ¿ ema300 (è¯¦ç»†EMAä¿¡æ¯)
- mark Â± spread
- vwapå·®å€¼
- bid/ask (ç®€åŒ–ç›˜å£)
- dte

**å®½åº¦**ï¼š~85å­—ç¬¦

---

### Fullï¼ˆå®Œæ•´ï¼‰

**ç›®æ ‡**ï¼šæ‰€æœ‰ä¿¡æ¯ï¼ˆå½“å‰é»˜è®¤ï¼‰

```
AAPL 0816 C220: [u 225.50 (I +2.50%)] [iv 0.25] [d +0.65] 5.25 > 5.10 5.80 Â±0.15  5.75 x 10   5.85 x 15  +0.10 (2s) (s 214.20 @ +11.30) (30.5 d)
```

**å­—æ®µ**ï¼šæ‰€æœ‰å­—æ®µ

**å®½åº¦**ï¼š~180å­—ç¬¦

---

## ğŸ”§ å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ¡ä»¶æ˜¾ç¤ºï¼ˆå¿«é€Ÿå®ç°ï¼‰

åœ¨å½“å‰ `formatTicker()` ä¸­æ·»åŠ æ¡ä»¶åˆ¤æ–­ï¼š

```python
def formatTicker(c):
    # ... è®¡ç®—æ‰€æœ‰å­—æ®µ ...

    # æ ¹æ® quote_preset é€‰æ‹©æ˜¾ç¤ºå­—æ®µ
    quote_mode = display_config.quote_preset

    if isinstance(c.contract, (Option, FuturesOption)):
        if quote_mode == "minimal":
            return " ".join([
                rowName,
                f"{mark:>6}",
                f"{bid:>6}x{ask:>6}",
                f"{percentUpFromClose:>+6.2f}%",
            ])

        elif quote_mode == "compact":
            return " ".join([
                rowName,
                f"[u{und:>6,.1f}]",
                f"[d{delta:>+5.2f}]",
                f"{mark:>6} Â±{spread:<4}",
                f"{bid:>6}x{b_s} {ask:>6}x{a_s}",
            ])

        elif quote_mode == "trading":
            return " ".join([
                rowName,
                f"[u{und:>6,.1f} {itm}]",
                f"[d{delta:>+5.2f}]",
                f"{e100:>6}{trend}{e300:>6}",
                f"{mark:>6}Â±{spread:<4}",
                f"{bid:>6}x{b_s} {ask:>6}x{a_s}",
                f"{when:.0f}d",
            ])

        elif quote_mode == "options":
            return " ".join([
                rowName,
                f"[u{und:>6,.1f} {itm} {underlyingStrikeDifference:>+6.2f}%]",
                f"[iv{iv:.2f} d{delta:>+5.2f} g{gamma:.2f} t{theta:>+5.2f}]",
                f"{mark:>6}Â±{spread:<4}",
                f"{bid:>6}x{b_s} {ask:>6}x{a_s}",
                f"{when:.0f}d",
            ])

        else:  # full or default
            return " ".join([...])  # å½“å‰å®Œæ•´æ ¼å¼
```

**ä¼˜ç‚¹**ï¼š
- âœ… å¿«é€Ÿå®ç°
- âœ… ä¸ç ´åç°æœ‰ä»£ç 
- âœ… ç«‹å³å¯ç”¨

**ç¼ºç‚¹**ï¼š
- âŒ ä»£ç é‡å¤
- âŒ éš¾ä»¥ç»´æŠ¤
- âŒ æ ¼å¼åŒ–é€»è¾‘æ··ä¹±

---

### æ–¹æ¡ˆ2ï¼šå­—æ®µæ˜ å°„è¡¨ï¼ˆæ¨èï¼‰

åˆ›å»ºå­—æ®µæ˜ å°„ç³»ç»Ÿï¼š

```python
# å®šä¹‰å­—æ®µæ ¼å¼åŒ–å‡½æ•°
OPTION_FIELD_FORMATTERS = {
    "sym": lambda c, data: data["rowName"],
    "underlying": lambda c, data: f"[u{data['und']:>6,.1f}]",
    "itm": lambda c, data: data['itm'],
    "delta": lambda c, data: f"[d{data['delta']:>+5.2f}]",
    "iv": lambda c, data: f"[iv{data['iv']:.2f}]",
    "mark": lambda c, data: f"{data['mark']:>6}",
    "spread": lambda c, data: f"Â±{data['spread']:<4}",
    "bid": lambda c, data: f"{data['bid']:>6}",
    "ask": lambda c, data: f"{data['ask']:>6}",
    "bidSize": lambda c, data: f"x{data['bidSize']}",
    "askSize": lambda c, data: f"x{data['askSize']}",
    # ... æ›´å¤šå­—æ®µ ...
}

def formatOptionQuote(c, fields: list[str]) -> str:
    """Format option quote based on field list."""
    # è®¡ç®—æ‰€æœ‰æ•°æ®
    data = {
        "rowName": format_option_symbol(...),
        "und": c.modelGreeks.undPrice,
        "delta": c.modelGreeks.delta,
        # ... ç­‰ç­‰
    }

    # æ ¹æ®å­—æ®µåˆ—è¡¨æ ¼å¼åŒ–
    parts = []
    for field in fields:
        if formatter := OPTION_FIELD_FORMATTERS.get(field):
            parts.append(formatter(c, data))

    return " ".join(parts)

# ä½¿ç”¨
fields = QUOTE_PRESETS[display_config.quote_preset]
return formatOptionQuote(c, fields)
```

**ä¼˜ç‚¹**ï¼š
- âœ… çµæ´»å¯é…ç½®
- âœ… æ˜“äºç»´æŠ¤
- âœ… æ”¯æŒè‡ªå®šä¹‰å­—æ®µ

**ç¼ºç‚¹**ï¼š
- âŒ éœ€è¦è¾ƒå¤§é‡æ„
- âŒ å®ç°æ—¶é—´è¾ƒé•¿

---

## ğŸ“ å¿«é€Ÿå®æ–½å»ºè®®

å¦‚æœä½ æƒ³**ç«‹å³å¯ç”¨** trading é£æ ¼çš„æœŸæƒæ˜¾ç¤ºï¼Œå»ºè®®ï¼š

### Phase 2Aï¼šæ·»åŠ  Trading é£æ ¼ï¼ˆ1-2å°æ—¶ï¼‰

1. **ä¿®æ”¹ `cli.py` formatTicker()**
2. **æ·»åŠ ç®€å•çš„æ¡ä»¶åˆ¤æ–­**
3. **å®ç° 3 ç§æ¨¡å¼ï¼šminimal, compact/trading, full**

**ä»£ç ç¤ºä¾‹**ï¼šè§æ–¹æ¡ˆ1

### Phase 2Bï¼šå®Œæ•´å­—æ®µç³»ç»Ÿï¼ˆ3-5å°æ—¶ï¼‰

1. **é‡æ„ä¸ºå­—æ®µæ˜ å°„ç³»ç»Ÿ**
2. **æ”¯æŒæ‰€æœ‰6ç§é¢„è®¾**
3. **æ”¯æŒè‡ªå®šä¹‰å­—æ®µ**

**ä»£ç ç¤ºä¾‹**ï¼šè§æ–¹æ¡ˆ2

---

## ğŸ¯ Trading é£æ ¼æœ€ç»ˆæ¨è

åŸºäºä½ çš„éœ€æ±‚ï¼Œ**Trading é£æ ¼**æœŸæƒåº”è¯¥æ˜¾ç¤ºï¼š

```
AAPL 0816 C220: [u225.5 I] [d+.65] 5.25>5.10 5.80Â±.15  5.75x10  5.85x15  30d
â”‚              â”‚            â”‚        â”‚         â”‚          â”‚         â”‚         â”‚
â”‚              â”‚            â”‚        â”‚         â”‚          â”‚         â”‚         â””â”€ åˆ°æœŸå¤©æ•°
â”‚              â”‚            â”‚        â”‚         â”‚          â”‚         â””â”€ å–ä»·xå–é‡
â”‚              â”‚            â”‚        â”‚         â”‚          â””â”€ ä¹°ä»·xä¹°é‡
â”‚              â”‚            â”‚        â”‚         â””â”€ æ ‡è®°ä»·Â±ä»·å·®
â”‚              â”‚            â”‚        â””â”€ EMA100 > EMA300ï¼ˆè¶‹åŠ¿ï¼‰
â”‚              â”‚            â””â”€ Deltaå¸Œè…Šå€¼
â”‚              â””â”€ æ ‡çš„ä»·æ ¼ + ITMæ ‡å¿—
â””â”€ æœŸæƒç¬¦å·ï¼ˆç´§å‡‘æ ¼å¼ï¼‰
```

**å­—æ®µæ¸…å•**ï¼š
1. âœ… sym - æœŸæƒç¬¦å·ï¼ˆAAPL 0816 C220ï¼‰
2. âœ… underlying - æ ‡çš„ä»·æ ¼ï¼ˆ225.5ï¼‰
3. âœ… itm - ITMæ ‡å¿—ï¼ˆIï¼‰
4. âœ… delta - Deltaï¼ˆ+0.65ï¼‰
5. âœ… ema100/ema300 - è¶‹åŠ¿ï¼ˆ5.25>5.10ï¼‰
6. âœ… mark - æ ‡è®°ä»·ï¼ˆ5.80ï¼‰
7. âœ… spread - ä»·å·®ï¼ˆÂ±0.15ï¼‰
8. âœ… bid/bidSize - ä¹°ä»·ä¹°é‡ï¼ˆ5.75x10ï¼‰
9. âœ… ask/askSize - å–ä»·å–é‡ï¼ˆ5.85x15ï¼‰
10. âœ… dte - åˆ°æœŸå¤©æ•°ï¼ˆ30dï¼‰

**å®½åº¦**ï¼šçº¦ **80-85 å­—ç¬¦**

---

éœ€è¦æˆ‘å¸®ä½ å®ç° **Phase 2Aï¼ˆå¿«é€Ÿæ·»åŠ  trading é£æ ¼ï¼‰** å—ï¼Ÿè¿˜æ˜¯å…ˆçœ‹çœ‹å½“å‰çš„å®Œæ•´æ˜¾ç¤ºæ•ˆæœå†å†³å®šï¼Ÿ