# GTC和RTH参数使用详解

## 概述

GTC（Good Till Cancel）和RTH（Regular Trading Hours）是两个重要的订单参数，用于控制订单的时间有效性和执行时间段。正确使用这些参数可以提高订单执行效率，避免意外成交。

## GTC - Good Till Cancel (持续有效)

### 什么是GTC？

GTC订单会一直有效，直到：
1. 完全成交
2. 手动取消
3. 达到最长有效期（IBKR为90天）

与之相对的是DAY订单，仅在当日收盘前有效。

### GTC语法

```bash
# 标准限价单 + GTC
buy AAPL 100 LMT @ 150.00 GTC

# 市价单 + GTC（较少使用）
buy SPY 100 MKT GTC

# 止损单 + GTC
sell AAPL 100 STP @ 145.00 GTC
```

### GTC支持情况

#### ✅ 支持GTC的订单类型

| 订单类型 | 说明 | 示例 |
|---------|------|------|
| LMT | 标准限价单 | `buy AAPL 100 LMT @ 150 GTC` |
| MKT | 市价单 | `buy AAPL 100 MKT GTC` |
| REL | 相对价格单 | `buy AAPL 100 REL @ -0.01 GTC` |
| STP | 止损单 | `sell AAPL 100 STP @ 145 GTC` |
| STPLMT | 止损限价单 | `sell AAPL 100 STPLMT @ 145:144 GTC` |
| TRAIL | 跟踪止损单 | `sell AAPL 100 TRAIL @ 5.00 GTC` |

#### ❌ 不支持GTC的订单类型（强制DAY）

| 订单类型 | 原因 | 替代方案 |
|---------|------|---------|
| AF | 算法订单，自动强制DAY | 使用 LMT + GTC |
| AS | 算法订单，自动强制DAY | 使用 LMT + GTC |
| AP | 算法订单，自动强制DAY | 使用 LMT + GTC |
| MID | 中间价订单，强制DAY | 使用 LMT + GTC |
| TWAP | 时间加权算法，仅当日 | 每日重新提交 |
| VWAP | 成交量加权算法，仅当日 | 每日重新提交 |

### GTC使用场景

#### 场景1：波段交易建仓
```bash
# 在支撑位145挂单，可以等待数天
buy AAPL 500 LMT @ 145.00 GTC

# 优势：
# - 无需每日重新提交订单
# - 价格到达自动成交
# - 适合耐心等待入场点
```

#### 场景2：长期止损保护
```bash
# 买入后立即设置止损
buy AAPL 100 LMT @ 150.00 GTC
sell AAPL 100 STP @ 145.00 GTC

# 优势：
# - 持续保护持仓
# - 不用每日重设止损
# - 自动风险控制
```

#### 场景3：跟踪止损锁利
```bash
# 持有盈利仓位，设置跟踪止损
sell AAPL 100 TRAIL @ 5.00 GTC

# 优势：
# - 自动跟随价格上涨
# - 锁定利润，限制损失
# - 长期有效无需维护
```

#### 场景4：分批建仓
```bash
# 在不同价位挂多个订单
buy AAPL 100 LMT @ 150.00 GTC
buy AAPL 100 LMT @ 148.00 GTC
buy AAPL 100 LMT @ 146.00 GTC

# 优势：
# - 分散入场成本
# - 自动执行策略
# - 减少盯盘时间
```

### GTC注意事项

#### 注意1：忘记的订单
```bash
# 问题：数天前的订单可能被遗忘
buy AAPL 100 LMT @ 130.00 GTC

# 数天后价格跌到130...
# 意外成交！可能已不想买入

# 解决：定期检查活跃订单
orders           # 查看所有GTC订单
cancel *         # 清理不需要的订单
```

#### 注意2：90天最长期限
```bash
# IBKR的GTC订单最长90天
buy AAPL 100 LMT @ 150.00 GTC

# 90天后自动取消
# 需要重新提交订单
```

#### 注意3：算法订单不支持
```bash
# 错误：AF不支持GTC
buy AAPL 100 AF @ 150.00 GTC  # ❌ 失败

# 正确：使用标准限价单
buy AAPL 100 LMT @ 150.00 GTC  # ✅ 成功
```

## RTH - Regular Trading Hours (常规交易时间)

### 什么是RTH？

RTH参数限制订单只在常规交易时间执行：
- **常规时间（RTH）**：9:30-16:00 ET
- **盘前盘后**：4:00-9:30 和 16:00-20:00 ET

默认情况下（不加RTH），订单允许在盘前盘后执行。

### RTH语法

```bash
# 标准限价单 + RTH
buy AAPL 100 LMT @ 150.00 RTH

# GTC + RTH 组合
buy AAPL 100 LMT @ 150.00 GTC RTH

# 市价单 + RTH
buy SPY 100 MKT RTH
```

### RTH支持情况

#### ✅ 支持RTH的订单类型

所有标准订单类型都支持RTH参数：
- LMT, MKT, REL, STP, STPLMT, TRAIL

#### ❌ 强制RTH的订单类型（自动RTH）

| 订单类型 | RTH行为 | 说明 |
|---------|---------|------|
| AF | 强制RTH | 自适应快速，仅常规时间 |
| AS | 强制RTH | 自适应慢速，仅常规时间 |
| AP | 强制RTH | 自适应耐心，仅常规时间 |
| MID | 强制RTH | 中间价，仅常规时间 |

### 盘前盘后交易特点

#### 盘前盘后的特点
1. **流动性低** - 买卖价差通常更大
2. **波动大** - 价格可能剧烈波动
3. **成交慢** - 订单可能需要更长时间成交
4. **风险高** - 价格可能偏离合理价值

#### 盘前盘后的机会
1. **财报交易** - 盘前盘后发布财报
2. **新闻反应** - 重要新闻发布后
3. **跳空交易** - 捕捉开盘跳空
4. **套利机会** - 价格异常时套利

### RTH使用场景

#### 场景1：避免盘前盘后价格异常
```bash
# 仅在常规时间执行，避免盘前盘后低流动性
buy AAPL 100 LMT @ 150.00 GTC RTH

# 优势：
# - 避免盘前盘后的大价差
# - 确保正常流动性
# - 减少滑点风险
```

#### 场景2：日内交易策略
```bash
# 严格的日内交易，仅常规时间
buy SPY 100 AF @ 450.00

# AF自动强制RTH，确保：
# - 仅在流动性最好时交易
# - 避免盘前盘后风险
# - 收盘前自动取消
```

#### 场景3：财报交易（允许盘前盘后）
```bash
# 财报在盘前发布，想立即交易
buy AAPL 100 LMT @ 155.00 GTC

# 不加RTH，允许盘前交易：
# - 可以在盘前成交
# - 捕捉财报驱动的行情
# - 注意：风险较高
```

#### 场景4：长期挂单
```bash
# 支撑位挂单，只在常规时间成交
buy AAPL 500 LMT @ 145.00 GTC RTH

# RTH确保：
# - 避免盘前盘后的价格异常
# - 仅在正常流动性时成交
# - 减少意外成交风险
```

## GTC + RTH 组合使用

### 组合方式

```bash
# 语法格式
buy <symbol> <qty> <type> @ <price> GTC RTH
#                                   ^^^  ^^^
#                            时间有效性  执行时间
```

### 四种组合

| 组合 | 时间有效性 | 执行时间 | 适用场景 |
|------|----------|---------|---------|
| 无GTC 无RTH | DAY | 4:00-20:00 | 日内交易，允许盘前盘后 |
| DAY RTH | DAY | 9:30-16:00 | 日内交易，仅常规时间 |
| GTC 无RTH | 直到取消 | 4:00-20:00 | 波段交易，允许盘前盘后 |
| GTC RTH | 直到取消 | 9:30-16:00 | 波段交易，仅常规时间 |

### 组合示例

#### 组合1：日内 + 全时段（默认）
```bash
buy AAPL 100 LMT @ 150.00

# 等同于：
buy AAPL 100 LMT @ 150.00 DAY

# 特点：
# - 当日收盘后取消
# - 允许盘前盘后交易
# - 适合：主动盯盘的日内交易
```

#### 组合2：日内 + 常规时间
```bash
buy AAPL 100 AF @ 150.00

# AF自动强制 DAY + RTH

# 特点：
# - 仅在9:30-16:00执行
# - 收盘前取消
# - 适合：日内交易，避免盘前盘后
```

#### 组合3：长期 + 全时段
```bash
buy AAPL 100 LMT @ 145.00 GTC

# 特点：
# - 可等待数天成交
# - 允许盘前盘后交易
# - 适合：不在意盘前盘后成交
```

#### 组合4：长期 + 常规时间（推荐）
```bash
buy AAPL 500 LMT @ 145.00 GTC RTH

# 特点：
# - 可等待数天成交
# - 仅在常规时间执行
# - 适合：多数波段交易策略
# - 推荐：最安全的长期挂单方式
```

## 最佳实践

### 1. 默认使用GTC RTH（波段交易）

```bash
# 推荐：安全的长期挂单
buy AAPL 100 LMT @ 150.00 GTC RTH

# 原因：
# ✅ 订单持续有效，无需每日重提
# ✅ 避免盘前盘后异常价格
# ✅ 确保正常流动性和价差
# ✅ 减少意外成交风险
```

### 2. 日内交易使用AF（自动DAY RTH）

```bash
# 推荐：快速日内交易
buy SPY 100 AF @ 450.00

# 原因：
# ✅ 自动强制DAY RTH
# ✅ 快速成交
# ✅ 收盘前自动取消
# ✅ 无需担心过夜风险
```

### 3. 财报交易不加RTH

```bash
# 财报在盘前/盘后发布
buy AAPL 100 LMT @ 155.00 GTC

# 原因：
# ✅ 可以在盘前盘后成交
# ✅ 捕捉第一时间行情
# ⚠️  注意：风险较高，价差大
```

### 4. 止损订单使用GTC

```bash
# 推荐：长期止损保护
sell AAPL 100 STP @ 145.00 GTC

# 是否加RTH取决于：
# - 加RTH：仅常规时间止损（更安全）
# - 不加：全天候保护（更全面）
```

### 5. 定期检查GTC订单

```bash
# 每周检查一次活跃订单
orders

# 清理不需要的订单
cancel *

# 避免：
# ❌ 忘记的订单意外成交
# ❌ 过时的价位
# ❌ 不再需要的订单
```

## 常见问题

### Q1: 为什么AF订单不支持GTC？

**A:** AF是IBKR的算法订单，设计用于日内快速执行。算法会根据当日市场条件优化执行策略，因此强制DAY。如需长期有效订单，使用标准限价单（LMT）。

```bash
# 错误
buy AAPL 100 AF @ 150 GTC  # ❌

# 正确
buy AAPL 100 LMT @ 150 GTC  # ✅
```

### Q2: MID订单为什么强制RTH？

**A:** 中间价（MIDPRICE）订单使用买卖价差的中间价。盘前盘后价差通常很大且不稳定，中间价可能严重偏离合理价值，因此IBKR强制仅在常规时间执行。

```bash
# MID自动强制RTH
buy AAPL 100 MID  # 自动仅在9:30-16:00执行
```

### Q3: GTC订单真的90天有效吗？

**A:** 是的，IBKR的GTC订单最长90天。超过90天会自动取消。实际上，大多数订单会在数天内成交或被手动取消。

### Q4: 不加RTH安全吗？

**A:** 取决于你的策略和风险承受能力：

**适合不加RTH的情况**：
- 财报交易，需要盘前盘后反应
- 跳空套利策略
- 全天候止损保护
- 对盘前盘后价格有明确预期

**应该加RTH的情况**：
- 波段交易长期挂单
- 不想承受盘前盘后风险
- 对盘前盘后行情不熟悉
- 大额订单（流动性考虑）

### Q5: 如何修改已提交的GTC订单？

```bash
# 查看活跃订单
orders

# 方式1：交互式修改
modify

# 方式2：指定订单ID
modify 123

# 方式3：取消后重新提交
cancel 123
buy AAPL 100 LMT @ 148.00 GTC RTH
```

### Q6: GTC订单会过夜吗？

**A:** 是的，GTC订单会保持活跃状态过夜，直到成交或取消。这与DAY订单不同，DAY订单会在当日收盘时自动取消。

```bash
# DAY订单：今日16:00自动取消
buy AAPL 100 LMT @ 150.00 DAY

# GTC订单：持续有效，可以过夜、过周末
buy AAPL 100 LMT @ 150.00 GTC
```

## 实战案例

### 案例1：波段交易完整流程

```bash
# 1. 在支撑位145挂单建仓（GTC RTH）
buy AAPL 500 LMT @ 145.00 GTC RTH

# 等待1-3天...
# 145成交！

# 2. 立即设置止盈止损（GTC）
sell AAPL 500 LMT @ 155.00 GTC RTH  # 止盈
sell AAPL 500 STP @ 142.00 GTC      # 止损（全天保护）

# 3. 持有数天或数周...
# 止盈或止损自动触发

# 优势：
# ✅ 全程自动化
# ✅ 无需每日操作
# ✅ 风险受控
```

### 案例2：日内交易流程

```bash
# 1. 早盘突破入场（AF自动DAY RTH）
buy SPY 100 AF @ 450.50 ± 2

# 2. 持有数小时...

# 3. 收盘前自动取消未成交部分
# AF自动DAY，无需担心过夜

# 优势：
# ✅ 快速执行
# ✅ 自动管理
# ✅ 无过夜风险
```

### 案例3：财报交易（盘前）

```bash
# 财报盘前7:00发布，利好！

# 盘前7:30挂单（不加RTH，允许盘前）
buy AAPL 100 LMT @ 155.00 GTC

# 盘前8:00成交！

# 同时设置止损（全天保护）
sell AAPL 100 TRAIL @ 3.00 GTC

# 优势：
# ✅ 捕捉盘前行情
# ✅ 第一时间入场
# ⚠️  注意：盘前价差大，需谨慎
```

### 案例4：分批建仓策略

```bash
# 计划在145-150区间分批买入2000股（GTC RTH）
buy AAPL 500 LMT @ 150.00 GTC RTH
buy AAPL 500 LMT @ 148.00 GTC RTH
buy AAPL 500 LMT @ 146.00 GTC RTH
buy AAPL 500 LMT @ 145.00 GTC RTH

# 等待数天...
# 150成交500
# 148成交500
# 146成交500
# 平均成本：148

# 统一止损
sell AAPL 1500 STP @ 143.00 GTC

# 优势：
# ✅ 分散成本
# ✅ 自动执行
# ✅ 无需盯盘
```

## 参数速查表

### GTC快速参考

| 场景 | 命令 | 说明 |
|------|------|------|
| 波段建仓 | `buy AAPL 100 LMT @ 150 GTC RTH` | 最常用，安全 |
| 长期止损 | `sell AAPL 100 STP @ 145 GTC` | 全天保护 |
| 跟踪止损 | `sell AAPL 100 TRAIL @ 5 GTC` | 自动跟踪 |
| 分批建仓 | `buy AAPL 100 LMT @ 145 GTC RTH` | 多个订单 |

### RTH快速参考

| 场景 | 命令 | 说明 |
|------|------|------|
| 日内交易 | `buy SPY 100 AF @ 450` | 自动RTH |
| 避免盘前盘后 | `buy AAPL 100 LMT @ 150 RTH` | 明确RTH |
| 财报交易 | `buy AAPL 100 LMT @ 155 GTC` | 不加RTH |
| 跳空交易 | `buy AAPL 100 LMT @ 160` | 不加RTH |

## 总结

### GTC使用原则
1. ✅ 波段交易默认使用GTC
2. ✅ 止损订单优先使用GTC
3. ✅ 定期检查清理GTC订单
4. ❌ 不要忘记GTC订单
5. ❌ 算法订单不支持GTC

### RTH使用原则
1. ✅ 波段挂单建议加RTH
2. ✅ 不熟悉盘前盘后时加RTH
3. ✅ 大额订单考虑加RTH
4. ❌ 财报交易不加RTH
5. ❌ 需要全天保护时不加RTH

### 黄金组合
```bash
# 最推荐的波段交易组合
buy <symbol> <qty> LMT @ <price> GTC RTH
```

这个组合提供：
- ✅ 持续有效直到成交或取消
- ✅ 仅在流动性最好时执行
- ✅ 避免盘前盘后价格异常
- ✅ 安全可靠的长期挂单

## 参考资源

- [订单类型完整指南](ORDER_TYPES.md)
- [止盈止损订单详解](BRACKET_ORDERS.md)
- [快速入门指南](QUICK_START.md)
- [IBKR交易时间说明](https://www.interactivebrokers.com/en/index.php?f=1563)
