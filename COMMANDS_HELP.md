# ICLI 命令参考手册

本文档包含所有 ICLI 命令的详细使用说明。使用 `man <命令>` 查看具体命令的帮助。

---

## buy

**分类**: 订单管理
**别名**: 无

**描述**: 买入或卖出股票/期权。正数表示买入，负数表示卖出。

**用法示例**:

```bash
# 基础买卖
buy AAPL 100 MID              # 中间价买入100股
buy AAPL 100 MKT              # 市价买入100股
buy AAPL 100 AF               # 自适应算法买入
buy AAPL $10000 MID           # 买入价值$10000的股票
buy AAPL -100 MID             # 卖出100股

# 限价单
buy AAPL 100 AF @ 233.33      # 限价$233.33买入
buy AAPL 100 AF @ 233.33 + 10 # 限价买入+止盈
buy AAPL 100 AF @ 233.33 - 10 # 限价买入+止损
buy AAPL 100 AF @ 233.33 ± 10 # 限价买入+OCO括号单

# 订单时效
buy AAPL 100 MID GTC          # Good Till Cancel - 直到取消
buy AAPL 100 MID RTH          # Regular Trading Hours - 仅常规交易时段

# 预览模式
buy AAPL 100 AF preview       # 预览订单，不执行
```

**注意事项**:
- 正数表示买入，负数表示卖出
- 支持$金额或股数
- @ 后指定限价价格
- + 后指定止盈价差
- - 后指定止损价差
- ± 后指定止盈止损价差（OCO订单）

---

## sell

**分类**: 订单管理
**别名**: 无

**描述**: 同buy命令，buy AAPL -100 MID 等同于 sell。

**用法示例**:

```bash
# 参考buy命令，使用负数量即可
sell AAPL 100 MID             # 等同于 buy AAPL -100 MID
```

---

## cancel

**分类**: 订单管理
**别名**: 无

**描述**: 取消订单。

**用法示例**:

```bash
cancel                        # 显示菜单选择要取消的订单
cancel *                      # 取消所有活跃订单
cancel AAPL                   # 取消AAPL的所有订单
```

---

## orders

**分类**: 订单管理
**别名**: 无

**描述**: 查看所有活跃订单。

**用法示例**:

```bash
orders                        # 显示所有活跃订单
```

---

## modify

**分类**: 订单管理
**别名**: 无

**描述**: 修改现有订单。

**用法示例**:

```bash
modify                        # 交互式选择并修改订单
```

---

## evict

**分类**: 订单管理
**别名**: 无

**描述**: 快速平仓/清空持仓。

**用法示例**:

```bash
evict AAPL -1 0 MID           # 清空AAPL所有持仓
evict * -1 0 MID              # 清空所有持仓（危险！）
evict AAPL -1 0 AF            # 使用AF算法清空AAPL
```

**注意事项**:
- -1表示全部持仓，0表示目标仓位为0

---

## limit

**分类**: 订单管理
**别名**: 无

**描述**: 快速限价单。

**用法示例**:

```bash
limit AAPL 100 233.33         # 限价$233.33买入100股
limit AAPL -100 235           # 限价$235卖出100股
```

---

## positions

**分类**: 投资组合
**别名**: ls

**描述**: 查看当前持仓。

**用法示例**:

```bash
positions                     # 显示所有持仓
positions AAPL                # 只显示AAPL持仓
```

---

## balance

**分类**: 投资组合
**别名**: 无

**描述**: 查看账户余额和资金信息。

**用法示例**:

```bash
balance                       # 显示账户总览
balance SMA                   # 显示保证金账户信息
```

---

## cash

**分类**: 投资组合
**别名**: 无

**描述**: 查看现金余额。

**用法示例**:

```bash
cash                          # 显示可用现金
```

---

## executions

**分类**: 投资组合
**别名**: 无

**描述**: 查看订单执行记录。

**用法示例**:

```bash
executions                    # 显示今日执行记录
executions -v                 # 详细执行信息
executions -v AAPL            # 显示AAPL的执行记录
```

---

## ls

**分类**: 投资组合
**别名**: positions

**描述**: 同positions命令，查看持仓。

**用法示例**:

```bash
ls                            # 显示持仓
```

---

## add

**分类**: 行情管理
**别名**: 无

**描述**: 添加实时行情。

**用法示例**:

```bash
add SPY QQQ AAPL              # 添加多个股票行情
add "buy 1 AAPL 240816C00220000 sell 1 AAPL 240816C00215000"  # 添加价差行情
```

---

## remove

**分类**: 行情管理
**别名**: rm, qremove, qrm

**描述**: 移除实时行情。

**用法示例**:

```bash
remove SPY                    # 移除SPY行情
remove *                      # 移除所有行情
```

---

## qpos

**分类**: 行情管理
**别名**: 无

**描述**: 将所有持仓添加到行情监控。

**用法示例**:

```bash
qpos                          # 添加所有持仓到行情
```

---

## qquote

**分类**: 行情管理
**别名**: 无

**描述**: 快速查看单个标的报价。

**用法示例**:

```bash
qquote AAPL                   # 显示AAPL即时报价
```

---

## depth

**分类**: 行情管理
**别名**: 无

**描述**: 查看市场深度（DOM - Depth of Market）。

**用法示例**:

```bash
depth AAPL                    # 显示AAPL市场深度
```

---

## info

**分类**: 行情管理
**别名**: 无

**描述**: 查看标的详细信息（技术指标、希腊值等）。

**用法示例**:

```bash
info AAPL                     # 显示AAPL详细信息
```

---

## chains

**分类**: 行情管理
**别名**: 无

**描述**: 查看期权链。

**用法示例**:

```bash
chains AAPL                   # 显示AAPL期权链
chains AAPL 30                # 显示30天内到期的期权
```

---

## qadd

**分类**: 行情组管理
**别名**: 无

**描述**: 添加行情到组。

**用法示例**:

```bash
qadd tech SPY QQQ             # 添加SPY QQQ到tech组
qadd common AAPL MSFT         # 添加到common组
```

---

## qsave

**分类**: 行情组管理
**别名**: 无

**描述**: 保存当前行情为组。

**用法示例**:

```bash
qsave mygroup                 # 保存当前行情为mygroup
```

---

## qrestore

**分类**: 行情组管理
**别名**: 无

**描述**: 恢复已保存的行情组。

**用法示例**:

```bash
qrestore mygroup              # 恢复mygroup行情组
```

---

## qlist

**分类**: 行情组管理
**别名**: 无

**描述**: 列出所有已保存的行情组。

**用法示例**:

```bash
qlist                         # 列出所有行情组
```

---

## qdelete

**分类**: 行情组管理
**别名**: 无

**描述**: 删除行情组。

**用法示例**:

```bash
qdelete mygroup               # 删除mygroup行情组
```

---

## qclean

**分类**: 行情组管理
**别名**: 无

**描述**: 清理无效的行情。

**用法示例**:

```bash
qclean                        # 清理所有无效行情
```

---

## qsnapshot

**分类**: 行情组管理
**别名**: 无

**描述**: 创建行情快照。

**用法示例**:

```bash
qsnapshot                     # 保存当前行情快照
```

---

## qloadsnapshot

**分类**: 行情组管理
**别名**: 无

**描述**: 加载行情快照。

**用法示例**:

```bash
qloadsnapshot                 # 加载最近的快照
```

---

## ifthen

**分类**: 条件触发
**别名**: if

**描述**: 创建条件单（单次触发）。当条件满足时自动执行指定命令，触发后自动删除。

**用法示例**:

```bash
if QQQ last < 500: buy AAPL 100 MID
if AAPL bid > 300: buy AAPL -100 AF
if SPY ema60 > ema300: buy SPY 100 MID
```

**注意事项**:
- 支持条件：last, bid, ask, high, low, ema, atr
- 触发一次后自动删除

---

## auto

**分类**: 条件触发
**别名**: 无

**描述**: 创建持续监控的条件单程序。

**用法示例**:

```bash
auto if AAPL last > 300: buy AAPL -100 MID
auto if AAPL last < 280: buy AAPL 100 MID
```

**注意事项**:
- 条件触发后不会删除，会持续监控

---

## iflist

**分类**: 条件触发
**别名**: ifls

**描述**: 查看所有活跃的条件。

**用法示例**:

```bash
iflist                        # 显示所有条件
```

---

## ifrm

**分类**: 条件触发
**别名**: 无

**描述**: 删除指定条件。

**用法示例**:

```bash
ifrm <id>                     # 删除指定ID的条件
```

---

## ifclear

**分类**: 条件触发
**别名**: 无

**描述**: 清除所有条件。

**用法示例**:

```bash
ifclear                       # 删除所有条件
```

---

## ifgroup

**分类**: 条件触发
**别名**: 无

**描述**: 创建条件组。

**用法示例**:

```bash
ifgroup                       # 创建条件组
```

---

## cls

**分类**: 实用工具
**别名**: 无

**描述**: 清屏，清除终端屏幕内容。

**用法示例**:

```bash
cls                           # 清除终端屏幕
```

---

## hh

**分类**: 实用工具
**别名**: 无

**描述**: 显示快速参考指南，包含最常用的交易命令和示例。

**用法示例**:

```bash
hh                            # 显示常用命令帮助
```

---

## man

**分类**: 实用工具
**别名**: 无

**描述**: 查看命令详细帮助，类似Unix的man命令。

**用法示例**:

```bash
man                           # 列出所有命令
man buy                       # 查看buy命令详细帮助
man positions                 # 查看positions命令详细帮助
```

---

## math

**分类**: 实用工具
**别名**: 无

**描述**: 计算器功能，支持账户余额变量和复杂计算。

**用法示例**:

```bash
(/ :BP3 AAPL)                 # 计算可买多少股（33%保证金）
(* AAPL 100)                  # 计算100股的总价
(grow :AF 300)                # 计算资金增长
```

**注意事项**:
- :BP3 = 33%保证金可用资金
- :BP4 = 25%保证金可用资金
- :AF = 可用现金

---

## set

**分类**: 实用工具
**别名**: 无

**描述**: 设置变量或配置。

**用法示例**:

```bash
set bigerror yes              # 启用详细错误信息
set bigerror no               # 禁用详细错误信息
```

---

## unset

**分类**: 实用工具
**别名**: 无

**描述**: 删除变量设置。

**用法示例**:

```bash
unset bigerror                # 删除bigerror设置
```

---

## reconnect

**分类**: 实用工具
**别名**: 无

**描述**: 重新连接到IBKR Gateway。

**用法示例**:

```bash
reconnect                     # 重新连接
```

---

## say

**分类**: 实用工具
**别名**: 无

**描述**: 语音播报（仅macOS）。

**用法示例**:

```bash
say hello world               # 播报文字
```

---

## clear

**分类**: 实用工具
**别名**: 无

**描述**: 清除命令历史或数据。

**用法示例**:

```bash
clear                         # 清除数据
```

---

## sched-add

**分类**: 计划任务
**别名**: 无

**描述**: 添加定时任务，在指定时间执行命令。

**用法示例**:

```bash
sched-add 09:30 buy AAPL 100 MID  # 在09:30执行买入
```

---

## sched-list

**分类**: 计划任务
**别名**: slist

**描述**: 列出所有计划任务。

**用法示例**:

```bash
sched-list                    # 显示所有计划任务
```

---

## sched-cancel

**分类**: 计划任务
**别名**: scancel

**描述**: 取消计划任务。

**用法示例**:

```bash
sched-cancel <id>             # 取消指定任务
```

---

## tasklist

**分类**: 后台任务
**别名**: 无

**描述**: 查看后台任务。

**用法示例**:

```bash
tasklist                      # 显示所有后台任务
```

---

## taskcancel

**分类**: 后台任务
**别名**: 无

**描述**: 取消后台任务。

**用法示例**:

```bash
taskcancel <id>               # 取消指定任务
```

---

## expand

**分类**: 高级功能
**别名**: 无

**描述**: 批量并发执行命令，在{}中的每个标的会并发执行。

**用法示例**:

```bash
expand buy {AAPL,MSFT,NVDA} 100 MID
expand buy {META,GOOGL} $10000 AF
```

**注意事项**:
- {}中的每个标的会并发执行

---

## fast

**分类**: 高级功能
**别名**: 无

**描述**: 快速交易模式。

**用法示例**:

```bash
fast AAPL 100                 # 快速买入100股
```

---

## scale

**分类**: 高级功能
**别名**: 无

**描述**: 分级下单。

**用法示例**:

```bash
scale                         # 交互式分级下单
```

---

## straddle

**分类**: 高级功能
**别名**: 无

**描述**: 创建跨式期权组合（同时买入相同执行价的看涨和看跌期权）。

**用法示例**:

```bash
straddle AAPL                 # 创建AAPL跨式组合
```

---

## simulate

**分类**: 高级功能
**别名**: 无

**描述**: 模拟交易。

**用法示例**:

```bash
simulate buy AAPL 100 MID     # 模拟买入
```

---

## paper

**分类**: 高级功能
**别名**: 无

**描述**: 切换模拟/实盘模式。

**用法示例**:

```bash
paper                         # 切换模式
```

---

## calendar

**分类**: 其他
**别名**: 无

**描述**: 查看交易日历。

**用法示例**:

```bash
calendar                      # 显示交易日历
```

---

## details

**分类**: 其他
**别名**: 无

**描述**: 查看标的详细信息。

**用法示例**:

```bash
details AAPL                  # 显示AAPL详细信息
```

---

## meta

**分类**: 其他
**别名**: 无

**描述**: 查看元数据信息。

**用法示例**:

```bash
meta                          # 显示元数据
```

---

## report

**分类**: 其他
**别名**: 无

**描述**: 生成报告。

**用法示例**:

```bash
report                        # 生成交易报告
```

---

## reporter

**分类**: 其他
**别名**: 无

**描述**: 报告生成器。

**用法示例**:

```bash
reporter                      # 启动报告生成器
```

---

## advice

**分类**: 其他
**别名**: 无

**描述**: 获取交易建议。

**用法示例**:

```bash
advice AAPL                   # 获取AAPL交易建议
```

---

## alert

**分类**: 其他
**别名**: 无

**描述**: 设置价格警报。

**用法示例**:

```bash
alert AAPL 300                # AAPL到300时提醒
```

---

## alias

**分类**: 其他
**别名**: 无

**描述**: 设置命令别名。

**用法示例**:

```bash
alias p positions             # 设置p为positions别名
```

---

## colorset

**分类**: 其他
**别名**: 无

**描述**: 设置颜色方案。

**用法示例**:

```bash
colorset dark                 # 使用深色方案
```

---

## colorsload

**分类**: 其他
**别名**: 无

**描述**: 加载颜色配置。

**用法示例**:

```bash
colorsload                    # 加载颜色配置
```

---

## daydumper

**分类**: 其他
**别名**: 无

**描述**: 导出当日数据。

**用法示例**:

```bash
daydumper                     # 导出数据
```

---

## oadd

**分类**: 其他
**别名**: 无

**描述**: 添加期权行情（高级）。

**用法示例**:

```bash
oadd AAPL 300 P 30            # 添加AAPL看跌期权
```

---

## prequalify

**分类**: 其他
**别名**: 无

**描述**: 预检查订单资格。

**用法示例**:

```bash
prequalify AAPL 100           # 检查能否买入
```

---

## qualify

**分类**: 其他
**别名**: 无

**描述**: 资格检查。

**用法示例**:

```bash
qualify                       # 检查账户资格
```

---

## range

**分类**: 其他
**别名**: 无

**描述**: 查看价格区间。

**用法示例**:

```bash
range AAPL                    # 显示AAPL价格区间
```

---

## rid

**分类**: 其他
**别名**: 无

**描述**: 通过ID操作。

**用法示例**:

```bash
rid <id>                      # 根据ID操作
```

---

## sadd

**分类**: 其他
**别名**: 无

**描述**: 添加到选择集。

**用法示例**:

```bash
sadd AAPL                     # 添加AAPL到选择集
```

---

## align

**分类**: 其他
**别名**: 无

**描述**: 对齐持仓。

**用法示例**:

```bash
align                         # 对齐持仓
```

---
